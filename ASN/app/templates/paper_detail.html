<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Academic Social Network Platform - paper detail</title>

	<!-- jquery -->
	<script type="text/javascript" src="../static/jquery/jquery-3.3.1.min.js"></script>
	<!-- bootstrap-3.3.7 -->
	<link href="../static/bootstrap-3.3.7-dist/css/bootstrap.min.css" type="text/css" rel="stylesheet" />
	<script src="../static/bootstrap-3.3.7-dist/js/bootstrap.min.js" type="text/javascript"></script>
	<!-- font-awesome-4.7.0 -->
	<link href="../static/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />

    <!-- vue -->
    <script src="../static/vue/js/vue.js" type="text/javascript"></script>

    <!-- echarts -->
    <script src="../static/echarts/js/echarts.min.js"></script>

    <link href="../static/common/animate.css" rel="stylesheet">
    <link href="../static/common/style.css" rel="stylesheet">

</head>

<body class="gray-bg">

	<div class="navbar-wrapper">
	    <nav class="navbar navbar-default navbar-fixed-top white-bg" role="navigation">
	        <div class="container" id="status">
				<div class="navbar-header">
                    <a class="navbar-brand" href="/user/home" style="margin-left: 0px;padding: 7.5px 0px;">
                    	<img src="../static/common/img/logo.png" height="40px" />
                    </a>
                </div>
                <ul class="nav navbar-top-links navbar-right" style="margin-right: -40px;" v-if="loginStatus">
                    <li class="dropdown">
                        <a class="dropdown-toggle" href="/user/private_profile" data-hover="dropdown" style="padding: 0px 0px;min-height: 0px;" title="用户">
                            <img alt="image" class="img-circle" :src="avatarSrc" width="40px" height="40px">
                            <strong>{{ firstName }}&nbsp;{{ lastName }}</strong>
                            <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu" role="menu" style="margin-top: 10px;min-width: 100px;">
                            <li class="pull-right">
                                <div href="#" style="padding: 3px 3px;margin: 4px;line-height: 25px;font-size: 14px;">{{ email }}</div>
                            </li>
                        </ul>
                    </li>
                    <span style="padding:15px 0px 5px 0px;margin: 0px 2px 0px 6px;border-left: 1px solid #999c9e;font-size: 0;"></span>
                    <li>
                        <a title="注销" href="/api/logout">
                            <i class="fa fa-sign-out fa-lg"></i> Log out
                        </a>
                    </li>
                </ul>
                <ul class="nav navbar-top-links navbar-right" style="margin-right: -40px;" v-else>
                    <li>
                        <a title="注册" href="/user/regist">
                            <i class="fa fa-registered fa-lg"></i> Register
                        </a>
                    </li>
                    <span style="padding:15px 0px 5px 0px;margin: 0px 2px 0px 6px;border-left: 1px solid #999c9e;font-size: 0;"></span>
                    <li>
                        <a title="登录"  href="/user/login">
                            <i class="fa fa-sign-in fa-lg"></i> Log in&nbsp;&nbsp;&nbsp;
                        </a>
                    </li>
                </ul>
	        </div>
	    </nav>
	</div>

	<div class="wrapper wrapper-content" style="padding-top: 100px;">
		<div class="container" id="paper_detail">
			<div class="row">
				<div class="col-lg-9">
					<div class="ibox">
	                    <div class="ibox-content">
	                    	<h1>{{ paper_title }}
	                    		<!-- <a class="pull-right" href="" title="查看原文"><i class="fa fa-file-pdf-o "></i></a> -->
	                    	</h1>

	                    </div>
	                </div>

					<div class="ibox">
						<div class="ibox-title">
	                        <h5>Abstract</h5>
	                        <div class="ibox-tools">
	                            <a class="collapse-link">
	                                <i class="fa fa-chevron-up"></i>
	                            </a>
	                        </div>
	                    </div>

	                    <div class="ibox-content">
	                        <p>
	                            {{ paper_abstract }}
	                        </p>
	                    </div>
	                </div>

					<div class="ibox">
						<div class="ibox-title">
	                        <h5>Reference</h5>
	                        <div class="ibox-tools">
	                            <a class="collapse-link">
	                                <i class="fa fa-chevron-up"></i>
	                            </a>
	                        </div>
	                    </div>

	                    <div class="ibox-content">
	                        <p>
	                            {{ paper_reference }}
	                        </p>
	                    </div>
	                </div>

	                <div class="tabs-container">
                        <ul class="nav nav-tabs" id="chartTab">
                            <li class="active"><a data-toggle="tab" href="#chart1"> 论文关系图</a></li>
                            <!-- <li class=""><a data-toggle="tab" href="#tab-2">This is second tab</a></li> -->
                        </ul>
                        <div class="tab-content">
                            <div id="chart1" class="tab-pane active">
                        		<div class="panel-body" style="margin: 0;width: 100%;height: 500px;">
                                    <div id="paperGraph" style="height: 100%;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

				</div>


				<div class="col-lg-3">
					<div class="wrapper wrapper-content">
	                    <h3>About</h3>
	                    <!-- <img src="img/zender_logo.png" class="img-responsive"> -->
	                    <p class="small">
	                        <span class="font-bold"><i class="fa fa-circle text-danger"></i> Co-authors: </span><a v-for="item in paper_coauthors" v-on:click="toSearchPage('author', item)">{{ item }},&nbsp;</a>
	                    </p>
	                    <p class="small">
	                        <span class="font-bold"><i class="fa fa-circle text-warning"></i> Venue: </span>{{ paper_venue }}
	                    </p>
	                    <p class="small">
	                        <span class="font-bold"><i class="fa fa-circle text-info"></i> Year: </span>{{ paper_year }}
	                    </p>
	                    <p class="small">
	                        <span class="font-bold"><i class="fa fa-circle text-success"></i> Related fields: </span>
	                    </p>
	                    <ul class="tag-list" style="padding: 0;" v-for="item in paper_keywords">
	                        <li><a v-on:click="toSearchPage('paper', item)"><i class="fa fa-tag"></i> {{ item }}</a></li>
	                    </ul>
	                </div>

				</div>
			</div>
		</div>

	</div>


	<script type="text/javascript">
	    // Collapse ibox function
	    $('.collapse-link').click(function () {
	        var ibox = $(this).closest('div.ibox');
	        var button = $(this).find('i');
	        var content = ibox.find('div.ibox-content');
	        content.slideToggle(200);
	        button.toggleClass('fa-chevron-up').toggleClass('fa-chevron-down');
	        ibox.toggleClass('').toggleClass('border-bottom');
	        setTimeout(function () {
	            ibox.resize();
	            ibox.find('[id^=map-]').resize();
	        }, 50);
	    });
	</script>

	<script type="text/javascript">
		//顶部用户信息显示
    	data1 = {
            loginStatus: [[Status.loginStatus|tojson]],
            {% if current_user.email %}
            firstName: [[current_user.first_name|tojson]],
            lastName: [[current_user.last_name|tojson]],
            email: [[current_user.email|tojson]],
            avatarSrc: [[current_user.avatar|tojson]]
            {% else %}
            firstName: "",
            lastName: "",
            email: "",
            avatarSrc: ""
            {% endif %}
        }
        var app1 = new Vue({
            el: '#status',
            data: data1
        });

        //论文信息
        var res = JSON.parse([[paperDetail|tojson]])
        data2 = {
        	paper_title: res.title,
        	paper_abstract: res.abstract,
        	paper_reference: res.ref_id,
        	paper_coauthors: res.co_authors,
        	paper_venue: res.venue,
        	paper_year: res.year,
        	paper_keywords: res.keywords
        }
        
        var app2 = new Vue({
        	el: '#paper_detail',
        	data: data2,
        	methods: {
        		toSearchPage: function(searchType, searchContent) {
        			window.open("/api/paper_authors?type=" + searchType + "&content=" + searchContent + "&p_page=1&a_page=1")
        		}
        	}
        })
	</script>

	<script type="text/javascript">
        //论文关系图
        var dom1 = document.getElementById("paperGraph");
        var myChartGraph1 = echarts.init(dom1);
        option1 = null;
        // app.title = '论文关系图';

        var sendData1 = {"paperID": res.id}
       	myChartGraph1.resize({width: 805, height: 459});
		myChartGraph1.showLoading();

        function getPaperNetwork() {
	        $.ajax({
	        	url: "/api/paper_network",
	        	type: "POST",
	        	data: sendData1,
	        	success: function(data){
		        	myChartGraph1.hideLoading();

		        	var graph = JSON.parse(data);

		        	graph.nodes.forEach(function(node){
		        		if (node.name === sendData1.paperID) {
		    		        node.itemStyle = {
		    		        	color: '#66CCFF'
		    		        };
		        		}
		        		else {
		    		        node.itemStyle = {
		    		        	color: '#FF3030'
		    		        };
		    		    }					        
		        		// node.symbolSize = 10;
				        // node.value = node.symbolSize;
				        // node.category = node.attributes.modularity_class;
				        // Use random x, y
				        node.x = node.y = null;
				        node.draggable = false;
				        // node.label = {
				        // 	show: true,
				        // 	position: 'bottom'
				        // };
				        // node.tooltip = {           
				        // 	position: function (point, params, dom, rect, size) {
				        //         $(dom).html('<div class="contact-box" style="color: #676a6c;background-color: #F0FFFF;padding: 10px;width: 120%;"><div style="width: 40%;float: left;"><div class="text-center" style="text-align: center;"><img alt="image" class="img-circle m-t-xs img-responsive" src="../static/common/img/init.png" width="64px" height="64px"><div class="m-t-xs font-bold">博士</div></div></div><div style="width: 60%;float: left;"><h4><strong>'+ node.name +'</strong><img alt="image"\ src="../static/common/img/female.png" width="20px" height="20px" style="margin: 0px 0px 2px 5px;"></h4><p><i class="fa fa-institution"></i> 华南理工大学</p><p><i class="fa fa-map-marker"></i> 广州大学城</p><p><i class="fa fa-phone"></i> 1377777777</p></div><div class="clearfix"></div></div>')
				        //     },
				        //     backgroundColor: '#FFFFFF'
				        // }
		        	})

		        	graph.links.forEach(function(link) {
		        		link.lineStyle = {
		        			width: link.values,
		        			color: '#000000'
		        		}
		        	})

	        	    option1 = {
				        title: {
				        	text: 'paper',
				            subtext: '',
				            top: 'bottom',
				            left: 'right'
				        },
				        tooltip: {},
				        toolbox: {
				        	show: true,
				        	feature: {
				        		dataView: {readOnly: true},
				        		restore: {},
				        		saveAsImage: {}
				        	}
				        },
				        legend: {
				            // selectedMode: 'single',
				            data: []
				        },
				        animation: false,
				        series : [
				            {
				                name: '',
				                type: 'graph',
				                layout: 'force',
                                data: graph.nodes,
            					links: graph.links,
				                roam: true,
				                forceNodeAdjacency: true,
				                cursor: 'pointer',
				                label: {
				                    normal: {
				                        position: 'right'
				                    }
				                },
				                force: {
				                    repulsion: 100
				                }
				            }
				        ]
				    };

				    myChartGraph1.setOption(option1);
				    myChartGraph1.resize();
	        	},
	        	error: function (errorMsg) {
		            //alert("图表数据加载失败！");
		        }
	        });
        }

        $('#chartTab a[data-toggle="tab"]').on('shown.bs.tab', function(e) {  
            myChartGraph1.resize();
	    });         
	    window.onresize = function() {
        	myChartGraph1.resize();
        }

        getPaperNetwork();
	</script>

	<div id="return-top" style="position: fixed;right: 1%;bottom: 4%;z-index: 99;">
	    <a onclick="backToTop()">
	        <img src="../static/common/img/return-top.png" title="返回顶部">
	    </a>
    </div>
    <script type="text/javascript">
    	function backToTop() {  
		    $('html,body').animate({  
		        scrollTop: 0  
		    }, 800);  
		}

		$(window).on('scroll', function () {
		    if ($(window).scrollTop() > $(window).height())  
		        $("#return-top").fadeIn();  
		    else  
		        $("#return-top").fadeOut();  
		});  
		$(window).trigger('scroll');
    </script>
</body>

</html>