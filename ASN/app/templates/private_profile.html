<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="User login page" />
    <meta name="author" content="" />

	<title>Academic Social Network Platform - private profile</title>

	<!-- jquery -->
	<script type="text/javascript" src="../static/jquery/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="../static/jquery/jquery-migrate-3.0.1.min.js"></script>
	<!-- jquery-validation -->
	<script type="text/javascript" src="../static/jquery-validation-1.17.0/dist/jquery.validate.min.js"></script>
	<script type="text/javascript" src="../static/jquery-validation-1.17.0/dist/localization/messages_zh.min.js"></script>
	<!-- bootstrap-3.3.7 -->
	<link href="../static/bootstrap-3.3.7-dist/css/bootstrap.min.css" type="text/css" rel="stylesheet" />
	<script src="../static/bootstrap-3.3.7-dist/js/bootstrap.min.js" type="text/javascript"></script>
	<!-- font-awesome-4.7.0 -->
	<link href="../static/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
	<!-- text fonts -->
	<link rel="stylesheet" href="../static/common/login/ace-fonts.css" />
	<!-- ace styles -->
	<!-- <link rel="stylesheet" href="../static/common/login/ace.css" /> -->

    <!-- vue -->
    <script src="../static/vue/js/vue.js" type="text/javascript"></script>

    <!-- bootstrap-hover-dropdown -->
    <script src="../static/bootstrap-hover-dropdown/js/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>

	<!-- dropzone-5.4.0 -->
	<link href="../static/dropzone-5.4.0/css/dropzone.css" rel="stylesheet">
	<script src="../static/dropzone-5.4.0/js/dropzone.js"></script>

    <!-- sweetalert -->
    <link href="../static/sweetalert/css/sweetalert.css" rel="stylesheet">
    <script src="../static/sweetalert/js/sweetalert.min.js"></script>

    <!-- chosen -->
    <link href="../static/chosen/css/chosen.css" rel="stylesheet">
    <script src="../static/chosen/js/chosen.jquery.js"></script>

    <!-- echarts -->
    <script src="../static/echarts/js/echarts.min.js"></script>

    <link href="../static/common/animate.css" rel="stylesheet">
    <link href="../static/common/style.css" rel="stylesheet">
    <link href="../static/common/style2.css" rel="stylesheet">

</head>
<body class="gray-bg">

	<div class="navbar-wrapper">
	    <nav class="navbar navbar-default navbar-fixed-top white-bg" role="navigation">
	        <div class="container" id="status">
	            <div class="navbar-header">
                    <a class="navbar-brand" href="/user/home" style="margin-left: 0px;padding: 7.5px 0px;">
                    	<img src="../static/common/img/logo.png" height="40px" />
                    </a>
                </div>
                <ul class="nav navbar-top-links navbar-right" style="margin-right: -40px;">
                    <li class="dropdown">
                        <a class="dropdown-toggle" href="/user/private_profile" data-hover="dropdown" style="padding: 0px 0px;min-height: 0px;" title="用户">
                            <img alt="image" class="img-circle" :src="avatarSrc" width="40px" height="40px">
                            <strong>{{ firstName }}&nbsp;{{ lastName }}</strong>
                            <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu" role="menu" style="margin-top: 10px;min-width: 100px;">
                            <li class="pull-right">
                                <div href="#" style="padding: 3px 3px;margin: 4px;line-height: 25px;font-size: 14px;">{{ email }}</div>
                            </li>
                        </ul>
                    </li>
                    <span style="padding:15px 0px 5px 0px;margin: 0px 2px 0px 6px;border-left: 1px solid #999c9e;font-size: 0;"></span>
                    <li>
                        <a title="注销" href="/api/logout">
                            <i class="fa fa-sign-out fa-lg"></i> Log out
                        </a>
                    </li>
                </ul>
	        </div>
	    </nav>
	</div>

	<div class="wrapper wrapper-content animated fadeIn" style="padding-top: 100px;">
		<div class="container">
			<div class="row">
                <div class="col-lg-12">
                    <div class="tabs-container">
                        <div class="tabs-left">
	                        <ul class="nav nav-tabs" id="mainTab">
	                            <li class="active"><a data-toggle="tab" href="#tab-1" id="tab1"><i class="fa fa-circle text-navy"></i> 个人信息</a></li>
	                            <li class=""><a data-toggle="tab" href="#tab-2" id="tab2"><i class="fa fa-circle text-danger"></i> 关注领域</a></li>
	                            <li class=""><a data-toggle="tab" href="#tab-3" id="tab3"><i class="fa fa-circle text-primary"></i> 我的关注&nbsp;&nbsp;<span class="badge badge-info"></span></a></li>
	                            <li class=""><a data-toggle="tab" href="#tab-4" id="tab4"><i class="fa fa-circle text-info"></i> 谁关注我&nbsp;&nbsp;<span class="badge badge-warning"></span></a></li>
	                            <li class=""><a data-toggle="tab" href="#tab-5" id="tab5"><i class="fa fa-circle text-warning"></i> 我的论文&nbsp;&nbsp;<span class="badge badge-danger"></span></a></li>
	                            <li class=""><a data-toggle="tab" href="#tab-6" id="tab6"><i class="fa fa-circle text-muted"></i> 关系图</a></li>
	                        </ul>
	                        <div class="tab-content">
	                            <div id="tab-1" class="tab-pane active">
	                                <div class="panel-body">
	                                	<div class="col-lg-12">
		                                	<div class="ibox-content" id="privateMessage">

							            		<div class="col-md-6 animated fadeInDown">
							                        <div class="widget-head-color-box navy-bg p-lg text-center">
							                            <div class="m-b-md">
								                            <h2 class="font-bold no-margins">
								                                {{ firstName }}&nbsp;{{ lastName }}
								                            </h2>
							                            </div>
							                            <img :src="avatarSrc" class="img-circle circle-border m-b-md" alt="profile" id="avatar" height="128px" width="128px">
							                            <div>
							                            	<div class="btn-group">
								                                <label title="Edit avatar" for="avatarSelected" class="btn btn-info">
								                                    <input type="file" accept="image/*" name="file" id="avatarSelected" class="hide">
								                                    <i class="fa fa-wrench"></i>&nbsp;修改头像
								                                </label>
								                            </div>
							                            </div>
							                        </div>
							                        <div class="widget-text-box">
							                            <div class="text-center">
							                            	<a href="#tab-3" id="toTab3"><small class="label label-danger"><i class="fa fa-hand-paper-o"></i> {{ paper_list_total }} 发表</small></a> |
							                                <a href="#tab-4" id="toTab4"><small class="label label-info"><i class="fa fa-hand-paper-o"></i> {{ following_list_total }} 关注</small></a> |
							                                <a href="#tab-5" id="toTab5"><small class="label label-warning"><i class="fa fa-hand-paper-o"></i> {{ followed_list_total }} 粉丝</small></a> 
							                            </div>
							                        </div>
							            		</div>

		                                		<div class="col-md-6 animated fadeInDown">
													<div class="form-horizontal" id="editForm">
									                    <div class="form-group">
									                    	<label class="col-sm-2 control-label">姓氏*</label>
									                        <div class="col-sm-4">
									                        	<input type="text" class="form-control" placeholder="" required="" id="firstname" disabled="disabled" v-model="firstName">
									                        </div>
															<label class="col-sm-2 control-label">名字*</label>
									                        <div class="col-sm-4">
									                        	<input type="text" class="form-control" placeholder="" required="" id="lastname" disabled="disabled" v-model="lastName">
									                        </div>
									                    </div>
									                    <div class="hr-line-dashed"></div>

									                    <div class="form-group">
									                    	<label class="col-sm-2 control-label">性别*</label>
									                    	<div class="col-sm-4">
									                        	<select name="gender" id="gender" class="form-control" disabled="disabled" v-model="genderSelected">
									        		                <option value="">请选择</option>
													                <option value="0">男</option>
													                <option value="1">女</option>
													            </select>
									                        </div>
									                        <label class="col-sm-2 control-label">学位*</label>
									                    	<div class="col-sm-4">
									                        	<select name="degree" id="degree" class="form-control" disabled="disabled" v-model="degreeSelected">
									        		                <option value="">请选择</option>
													                <option value="0">学士</option>
													                <option value="1">硕士</option>
													                <option value="2">博士</option>
													            </select>
									                        </div>
									                    </div>
									                    <div class="hr-line-dashed"></div>

									                    <div class="form-group">
									                    	<label class="col-sm-3 control-label">所属机构</label>
									                    	<div class="col-sm-9">
													            <input type="text" class="form-control" placeholder="" required="" id="department" disabled="disabled" v-model="department">       
															</div>
									                    </div>
									                    <div class="hr-line-dashed"></div>

									                    <div class="form-group">
									                    	<label class="col-sm-2 control-label">地址</label>
									                        <div class="col-sm-10">
									                        	<input type="text" class="form-control" placeholder="" required="" id="address" disabled="disabled" v-model="address">
									                        </div>
									                    </div>
									                    <div class="hr-line-dashed"></div>

									                    <div class="form-group">
									                    	<label class="col-sm-2 control-label">电话</label>
									                        <div class="col-sm-10">
									                        	<input type="text" class="form-control" placeholder="" required="" id="telephone" disabled="disabled" v-model="telephone">
									                        </div>
									                    </div>
									                    <div class="hr-line-dashed"></div>

									                    <div class="form-group">
										                    <div class="col-sm-12 col-sm-offset-3">
										                    	<button type="button" class="btn btn-white" style="width: 90px;" v-on:click="profile_edit" v-if="ifEdit">
										                    		<i class="fa fa-edit"></i>&nbsp;修改
										                    	</button>
										                    	<button type="button" class="btn btn-white" style="width: 90px;" v-on:click="profile_edit" v-else>
										                    		<i class="fa fa-close"></i>&nbsp;取消
										                    	</button>
										                    	<button type="button" class="btn btn-primary" style="width: 90px;" v-on:click="profile_confirm">
										                    		<i class="fa fa-check-square-o"></i>&nbsp;确认
										                    	</button>
										                    </div>
									                    </div>
									                </div>
									        	</div>
							            	</div>
	                                	</div>

	                                	<div class="col-lg-12">
		                                	<div class="ibox-content">
					                            <h3 class="tag-title"><i class="fa fa-key"></i>&nbsp;密码修改</h3>
		                                		<div class="form-horizontal" id="editPasswordForm">
					                            	<div class="col-md-6">
			                                            <div class="form-group">
			                                                <label>原密码 *</label>
			                                                <input id="oldPassword" type="password" class="form-control required" placeholder="请输入原密码">
			                                            </div>
			                                            <div class="form-group">
			                                                <label>新密码 *</label>
			                                                <input id="newPassword" type="password" class="form-control required" placeholder="请输入8~16位数字或英文字母">
			                                            </div>
			                                            <div class="form-group">
			                                                <label>确认新密码 *</label>
			                                                <input id="confirm_newPassword" type="password" class="form-control required" placeholder="请再次输入新密码">
			                                            </div>

									                    <div class="form-group">
										                    <div class="col-sm-12 col-sm-offset-9">
										                    	<button type="button" class="btn btn-primary" id="editNewPassword">
										                    		确认修改
										                    	</button>
										                    </div>
									                    </div>
			                                        </div>
			                                    </div>
		                                	</div>
	                                	</div>
						        	</div>
	                            </div>
	                            <div id="tab-2" class="tab-pane">
	                                <div class="panel-body">
	                                	<div class="col-md-12">
						            		<div class="ibox-content animated fadeInRight">
												<h3 class="tag-title">感兴趣的领域</h3>
								                <div class="form-group">
									                <div class="input-group">
								                	  	<div id="tagsInput">
											    			<v-tags :source.sync="source"></v-tags>
											    			<div v-show="isShowMultiSelect" style="display: block;margin-top: 5px;">
											                	<select data-placeholder="请选择..." class="chosen-select" id="addField" tabindex="1">
													                <option value=""></option>
													                <option value="Data Mining">Data Mining</option>
													                <option value="Machine Learning">Machine Learning</option>
													                <option value="Social Network">Social Network</option>
													                <option value="Deep Learning">Deep Learning</option>
													                <option value="Healthcare">Healthcare</option>
											                	</select>
											  				</div>
													  	</div>
									                </div>
							                	</div>
							                	
					                            <div class="clearfix"></div>
					                        </div>
					                    </div>
	                                </div>
	                            </div>
                             	<div id="tab-3" class="tab-pane">
	                                <div class="panel-body">
	                                	<div class="col-md-12">
	                                		<div class="ibox-content" id="followingList">
		                            	        <div class="wrapper wrapper-content animated fadeInRight">
											        <div class="row">

											            <div class="col-md-4" v-for="item,index in following_list">
											                <div class="contact-box" style="padding: 10px;">
											                    <a v-on:click="toPublicProfile(item.profile.id)">
												                    <div class="col-sm-5">
												                        <div class="text-center">
												                            <img alt="image" class="img-circle m-t-xs img-responsive" :src="item.profile.avatar" width="64px" height="64px">
												                            <div class="m-t-xs font-bold">{{ item.profile.education }}</div>
												                            <img alt="image" src="../static/common/img/male.png" width="20px" height="20px" style="margin: 0px 0px 2px 5px;" v-if="item.profile.gender==='0'">
												                        	<img alt="image" src="../static/common/img/female.png" width="20px" height="20px" style="margin: 0px 0px 2px 5px;" v-else>
												                        </div>
												                    </div>
												                    <div class="col-sm-7" style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">
												                        <h4>
												                        	<strong>{{ item.profile.name }}</strong>
												                        	
												                        </h4>
												                        <p><i class="fa fa-institution"></i> {{ item.profile.department }}</p>
												                        <p><i class="fa fa-map-marker"></i> {{ item.profile.address }}</p>
												                        <p><i class="fa fa-phone"></i> {{ item.profile.phone }}</p>
												                    </div>
												                    <div class="clearfix"></div>
										                        </a>
					                                            <div class="contact-box-footer" style="padding: 4px 0px 0px 0px;">
													                <div class="m-t-xs btn-group" v-if="item.isFollow" v-on:click="toUnfollow(item.profile.id, index)">
													                    <a class="btn btn-sm btn-white" style="background-color: #ffffff"><i class="fa fa-users"></i> Following</a>
													                </div>
													                <div class="m-t-xs btn-group" v-else v-on:click="toFollow(item.profile.id, index)">
													                    <a class="btn btn-sm btn-white"><i class="fa fa-user-plus"></i> Follow</a>
													                </div>
													            </div>
											                </div>
											            </div>
											            
											        </div>
											    </div>
											</div>
										</div>
	                                </div>
	                            </div>
                             	<div id="tab-4" class="tab-pane">
	                                <div class="panel-body">
										<div class="col-md-12">
											<div class="ibox-content" id="followedList">
		                            	        <div class="wrapper wrapper-content animated fadeInRight">
											        <div class="row">

											            <div class="col-md-4" v-for="item,index in followed_list">
											                <div class="contact-box" style="padding: 10px;">
											                    <a v-on:click="toPublicProfile(item.profile.id)">
												                    <div class="col-sm-5">
												                        <div class="text-center">
												                            <img alt="image" class="img-circle m-t-xs img-responsive" :src="item.profile.avatar" width="64px" height="64px">
												                            <div class="m-t-xs font-bold">{{ item.profile.education }}</div>
												                            <img alt="image" src="../static/common/img/male.png" width="20px" height="20px" style="margin: 0px 0px 2px 5px;" v-if="item.profile.gender==='0'">
												                        	<img alt="image" src="../static/common/img/female.png" width="20px" height="20px" style="margin: 0px 0px 2px 5px;" v-else>
												                        </div>
												                    </div>
												                    <div class="col-sm-7">
												                        <h3>
												                        	<strong>{{ item.profile.name }}</strong>
												                        </h3>
												                        <p><i class="fa fa-institution"></i> {{ item.profile.department }}</p>
												                        <p><i class="fa fa-map-marker"></i> {{ item.profile.address }}</p>
												                        <p><i class="fa fa-phone"></i> {{ item.profile.phone }}</p>
												                    </div>
												                    <div class="clearfix"></div>
										                        </a>
					                                            <div class="contact-box-footer" style="padding: 4px 0px 0px 0px;">
													                <div class="m-t-xs btn-group" v-if="item.isFollow" v-on:click="toUnfollow(item.profile.id, index)">
													                    <a class="btn btn-sm btn-white" style="background-color: #ffffff"><i class="fa fa-users"></i> Following</a>
													                </div>
													                <div class="m-t-xs btn-group" v-else v-on:click="toFollow(item.profile.id, index)">
													                    <a class="btn btn-sm btn-white"><i class="fa fa-user-plus"></i> Follow</a>
													                </div>
													            </div>
											                </div>
											            </div>

											        </div>
											    </div>
											</div>
										</div>
	                                </div>
	                            </div>
	                            <div id="tab-5" class="tab-pane">
	                                <div class="panel-body">

	                                	<div class="col-lg-12 animated fadeInRight">
							                <div class="ibox">
							                    <div class="ibox-title">
							                        <h5>上传论文</h5>
							                    </div>
							                    <div class="ibox-content">
							                    	<div class="form-group">
								                        <form id="my-awesome-dropzone" class="dropzone" method="POST" action="/api/upload_paper" enctype="multipart/form-data">
								                            <!-- <div class="dropzone-previews"></div> -->
						                                   	<div class="dropzone-previews"></div>
													        <button type="submit" class="btn btn-primary pull-right" style="margin-top: 140px;cursor: pointer">
									                        	<i class="fa fa-upload"></i>&nbsp;上传提交
									                    	</button>
								                        </form>
							                    	</div>
							                        
							                    </div>
							                </div>
							            </div>

						            	<div class="col-lg-12 animated bounce">
						            		<div class="ibox">
						            			<div class="ibox-content">
									            	<div id="vertical-timeline" class="vertical-container dark-timeline center-orientation">

							                            <div class="vertical-timeline-block" v-for="item in paperItem">
							                                <div class="vertical-timeline-icon blue-bg">
							                                    <i class="fa fa-file-text"></i>
							                                </div>

							                                <div class="vertical-timeline-content">
	                                                            <div class="file-box" style="margin-left: 17%;">
									                                <div class="file">
									                                    <a target="_blank" :href="item.fileURL">
									                                        <span class="corner"></span>
									                                        <div class="icon">
									                                            <i class="fa fa-file"></i>
									                                        </div>
									                                        <div class="file-name">
									                                            {{ item.fileName }}
									                                            <br/>
									                                            <!-- <small>Added: Jan 11, 2014</small> -->
									                                        </div>
									                                    </a>
									                                </div>
									                            </div>
							                                    <span class="vertical-date">
							                                        {{ item.date }}
							                                        <br/>
							                                        <small>{{ item.time }}</small>
							                                    </span>
							                                </div>
							                            </div>
														
						                        	</div>
						            			</div>
						            		</div>
						            	</div>
	                                    
	                                </div>
	                            </div>
	                            <div id="tab-6" class="tab-pane">
	                                <div class="panel-body">

						                <div class="col-lg-12">
						                	<div class="ibox-content">
						                		<div class="tabs-container">
							                        <ul class="nav nav-tabs" style="border-bottom: none;" id="chartTab">
							                            <!-- <li class="active"><a data-toggle="tab" href="#chart1"> 论文关系图</a></li> -->
							                            <li class="active"><a data-toggle="tab" href="#chart2"> 作者关系图</a></li>
							                        </ul>
							                        <div class="tab-content">
<!-- 							                            <div id="chart1" class="tab-pane active">
						                            		<div class="panel-body" style="margin: 0;width: 100%;height: 500px;">
							                                    <div id="paperGraph" style="height: 100%;"></div>
							                                </div>
							                            </div> -->
							                            <div id="chart2" class="tab-pane active">
							                                <div class="panel-body" style="margin: 0;width: 100%;height: 500px;">
																<div id="coauthorGraph" style="height: 100%;"></div>
							                                </div>
							                            </div>
							                        </div>
							                    </div>
						                	</div>
						                </div>

						            </div>
	                            </div>
	                        </div>
                        </div>

                    </div>
                </div>
            </div>
		</div>
	</div>

	<script type="text/javascript">
        function uploadAvatar() {
        	$("#avatarSelected").change(function() {
        		// var csrf = $("input[name='csrfmiddlewaretoken']").val();
			    var formData = new FormData();
			    // formData.append("csrfmiddlewaretoken",csrf);
			    formData.append('avatar', $("#avatarSelected")[0].files[0]);  /*获取上传的图片对象*/
			    $.ajax({
			      	url: '/api/upload_avatar',
		          	type: 'POST',
					data: formData,
					contentType: false,
					processData: false,
					success: function(args) {
			        	console.log(args);  /*服务器端的图片地址*/
			        	arg = JSON.parse(args);
						$("#avatar").attr('src', arg.msg);  /*预览图片*/
						$("#headerAvatar").attr('src', arg.msg);  /*预览图片*/
			     	},
			     	error: function() {
			     		console.log("error");
			     	}
				})
        	})
        };

        function cancelEditProfile(arg) {
		    arg.firstName = [[current_user.first_name|tojson]]
            arg.lastName = [[current_user.last_name|tojson]]
            arg.genderSelected = [[current_user.gender]]
            arg.degreeSelected = [[current_user.education]]
            arg.department = [[current_user.department|tojson]]
            arg.address = [[current_user.address|tojson]]
            arg.telephone = [[current_user.phone|tojson]]
            arg.ifEdit = true
        	$('#firstname').attr("disabled", true);
        	$('#lastname').attr("disabled", true);
        	$('#gender').attr("disabled", true);
        	$('#degree').attr("disabled", true);
        	$('#department').attr("disabled", true);
        	$('#address').attr("disabled", true);
        	$('#telephone').attr("disabled", true);
        };

        function getPaperList() {
        	$.ajax({
        		url: '/api/get_upload_paper',
        		type: 'POST',
        		data: {
        			userID: [[current_user.email|tojson]]
        		},
        		success: function(args){
        			var res = JSON.parse(args);
        			if (res.result === "success") {
        				data4.paperItem = res.paperItem

						$("span.badge-danger").text(data4.paperItem.length);
						data2.paper_list_total = data4.paperItem.length
        			} 
        			else {
        				console.log("获取论文列表失败! ");
        			}
        		},
        		error: function(){
        			console.log("请求获取论文列表失败! ");
        		}
			})
        };

        function editProfile(arg) {
        	$.ajax({
        		url: '/api/modify_user',
        		type: 'POST',
        		data: {
        			firstName: arg.firstName,
	                lastName: arg.lastName,
	                genderSelected: arg.genderSelected,
	                degreeSelected: arg.degreeSelected,
	                department: arg.department,
	                address: arg.address,
	                telephone: arg.telephone,
        		},
        		success: function(args) {
        			var res = JSON.parse(args);
        			if (res.result === "success") {
		                swal({
		                	title: "保存成功！", 
		                	text: "您的个人信息已经修改成功！", 
		                	type: "success"
		                }, function(){
		                	data1.firstName = res.newData.newFirstName;
		                	data1.lastName = res.newData.newLastName;
		                }); 
			            arg.ifEdit = true;
		            	$('#firstname').attr("disabled", true);
			        	$('#lastname').attr("disabled", true);
			        	$('#gender').attr("disabled", true);
			        	$('#degree').attr("disabled", true);
			        	$('#department').attr("disabled", true);
			        	$('#address').attr("disabled", true);
			        	$('#telephone').attr("disabled", true);
        			}
        			else {
	                	setTimeout(function(){
	                		window.location.reload();
	                	}, 500);
        				swal("修改失败! ", "请重新修改! ", "error");
        			}
        		},
        		error: function() {
    				swal("请求修改失败! ", "请重新修改! ", "error");
        		}
        	})
        };

	    function editPassword(OP, NP, CNP) {
	    	$.ajax({
        		url: '/api/modify_password',
        		type: 'POST',
        		data: {
        			oldPassword: OP,
        			newPassword: NP,
        			confirm_newPassword: CNP
        		},
        		success: function(data) {
        			var res = JSON.parse(data);
        			if (res.result === "success") {
		                swal({
		                	title: "新密码修改成功！", 
		                	text: "", 
		                	type: "success"
		                }, function(){
			        		$("#oldPassword").val("");
			        		$("#newPassword").val("");
			        		$("#confirm_newPassword").val("");
		                });
        			}
        			else {
		        		$("#oldPassword").val("");
		        		$("#newPassword").val("");
		        		$("#confirm_newPassword").val("");
        				swal("原密码错误! ", "请重新修改! ", "error");
        			}
        		},
        		error: function() {
	        		$("#oldPassword").val("");
	        		$("#newPassword").val("");
	        		$("#confirm_newPassword").val("");
    				swal("新密码请求修改失败! ", "请重新修改! ", "error");
        		}
        	})
	    };

	  //   function addTag(text) {
	  //   	var that = this
   //  		$.ajax({
   //      		url: '/api/add_tag',
   //      		type: 'POST',
   //      		data: {
   //      			text: text
   //      		},
   //      		success: function(args){
   //      			var res = JSON.parse(args);
   //      			if (res.result === "success") {
   //          			that.dis_source.push({
			//         		text: text
			//       		})
			//       		that.text = ''
   //      			} 
   //      			else {
   //      				that.text = ''
   //      				swal("添加标签失败! ", "请重新添加! ", "error");
   //      			}
   //      		},
   //      		error: function(){
   //      			that.text = ''
   //      			swal("请求添加标签失败! ", "请重新添加! ", "error");
   //      		}
			// })
	  //   };

	  //   function deleteTag(index) {
	  // 		var that = this
	  //     	$.ajax({
   //      		url: '/api/del_tag',
   //      		type: 'POST',
   //      		data: {
   //      			index: index
   //      		},
   //      		success: function(args){
   //      			var res = JSON.parse(args);
   //      			if (res.result === "success") {
   //      				that.dis_source.splice(index, 1)
   //      			} 
   //      			else {
   //      				swal("删除标签失败! ", "请重新删除! ", "error");
   //      			}
   //      		},
   //      		error: function(){
   //      			swal("请求删除标签失败! ", "请重新删除! ", "error");
   //      		}
			// });
   //    	};

	</script>

	<script type="text/javascript">
       	//顶部用户信息显示
    	data1 = {
            {% if current_user.email %}
            firstName: [[current_user.first_name|tojson]],
            lastName: [[current_user.last_name|tojson]],
            avatarSrc: [[current_user.avatar|tojson]],
            email: [[current_user.email|tojson]]
            {% else %}
            firstName: "",
            lastName: "",
            avatarSrc: "",
            email: ""
            {% endif %}
        }
        var app1 = new Vue({
            el: '#status',
            data: data1
        });

        //个人信息页
        data2 = {
        	ifEdit: true,            
        	following_list_total: "",
            followed_list_total: "",
            paper_list_total: "",
            {% if current_user.email %}
            firstName: [[current_user.first_name|tojson]],
            lastName: [[current_user.last_name|tojson]],
            genderSelected: [[current_user.gender]],
            degreeSelected: [[current_user.education]],
            department: [[current_user.department|tojson]],
            address: [[current_user.address|tojson]],
            telephone: [[current_user.phone|tojson]],
            avatarSrc: [[current_user.avatar|tojson]]
            {% else %}
            firstName: "",
            lastName: "",
            // email: "",
            genderSelected: "",
            degreeSelected: "",
            department: "",
            address: "",
            telephone: "",
            avatarSrc: ""
            {% endif %}
        }
		var app2 = new Vue({
            el: '#privateMessage',
            data: data2,
            methods: {
	            //个人信息确认按钮
            	profile_confirm: function() {
            		var vue2 = this

            		if (vue2.ifEdit === false) {
            			if (vue2.firstName==="" || vue2.lastName==="" || vue2.genderSelected==="" || vue2.degreeSelected==="") {
            				swal("*不能为空! ", "请重新修改! ", "error");
            			}
            			else {
							swal({
				                title: "修改个人信息",
				                text: "请问是否确认修改？",
				                type: "warning",
				                cancelButtonText: "取消",
				                showCancelButton: true,
				                confirmButtonColor: "#DD6B55",
				                confirmButtonText: "确认"
				            }, function (isConfirm) {
				            	if (isConfirm) {
				            		editProfile(vue2);
					            }
				            	else {
				            		cancelEditProfile(vue2);
				            	}
				            });
						}
	            	}
	            	else {
	            		swal("请先点击修改按钮! ", "", "error");
	            	}
            	},
            	//修改信息按钮
            	profile_edit: function() {
		        	if (this.ifEdit === true) {
		        		this.ifEdit = false;
		            	$('#firstname').removeAttr("disabled");
			        	$('#lastname').removeAttr("disabled");
			        	$('#gender').removeAttr("disabled");
			        	$('#degree').removeAttr("disabled");
			        	$('#department').removeAttr("disabled");
			        	$('#address').removeAttr("disabled");
			        	$('#telephone').removeAttr("disabled");
		    		}
		        	else {
						cancelEditProfile(this);
		        	}
		        }
		    }
        });

		//关注领域标签
  		var data3 = {
	    	isShowMultiSelect: false,
	      	source: [[current_user.focus_area|tojson]].split(',')
	      	// source: ['Data Mining', 'Machine Learning', 'Social Network']
	    }
	    if ('' === data3.source[0]) {
	    	data3.source = []
	    }
  		var tags = {
  			template: '<div class="input tags-wrap"><div class="tags-list" transition="tags" v-for="(item,index) in dis_source"><a @click="toSearchPage(item.text)"><i class="fa fa-tag" style="margin-right: 3px;"></i>{{ item.text }}</a><i class="fa fa-close" style="margin-left: 3px;" @click="del(index)"></i></div><input class="tags-input" type="text" placeholder="选择或输入按 Enter 创建" v-model="text" @keyup.enter="add(text)" v-on:focus="showMultiSelect"></div>',// v-on:blur="hideMultiSelect"
  			props: {
				source: {
					type: Array,
					default: []
				}
			},
			data: function(){
				var dis_source = []
		  		this.source.forEach(function (item) {
				    var obj = {
			      		text: item
				    }
			    	dis_source.push(obj)
			  	})
			  	return {
			    	text: '',
			    	dis_source: dis_source,
			  	}
			},
			methods: {
				add: function(text){
					var that = this
					var isExist = function(element){
						for (var i = 0;i < that.dis_source.length;i++) {
			    			if ( that.dis_source[i].text === element) {
			    				return true
			    			}
			    		}
			    		return false
					}
			    	if (text != ''){
			    		if (!isExist(text)){
				    		$.ajax({
				        		url: '/api/add_tag',
				        		type: 'POST',
				        		data: {
				        			text: text
				        		},
				        		success: function(args){
				        			var res = JSON.parse(args);
				        			if (res.result === "success") {
				            			that.dis_source.push({
							        		text: text
							      		})
							      		that.text = ''
				        			} 
				        			else {
				        				that.text = ''
				        				swal("添加标签失败! ", "请重新添加! ", "error");
				        			}
				        		},
				        		error: function(){
				        			that.text = ''
				        			swal("请求添加标签失败! ", "请重新添加! ", "error");
				        		}
							})
			    		}
			    		else{
			    			this.text = ''
			    			swal("已存在此标签! ", "", "error");
			    		}
			    	}
			  	},
			  	del: function(index){
			  		var that = this
			      	$.ajax({
		        		url: '/api/del_tag',
		        		type: 'POST',
		        		data: {
		        			index: index
		        		},
		        		success: function(args){
		        			var res = JSON.parse(args);
		        			if (res.result === "success") {
		        				that.dis_source.splice(index, 1)
		        			} 
		        			else {
		        				swal("删除标签失败! ", "请重新删除! ", "error");
		        			}
		        		},
		        		error: function(){
		        			swal("请求删除标签失败! ", "请重新删除! ", "error");
		        		}
					});
		    	},
		    	showMultiSelect: function(event){
		    		data3.isShowMultiSelect = true;
		    	},
		    	hideMultiSelect: function(envet){
		    		data3.isShowMultiSelect = false;
		    	},
		    	toSearchPage: function(searchContent) {
        			window.open("/api/search?type=paper" + "&content=" + searchContent + "&p_page=1&a_page=1")
        		}
			}
		}
		var app3 = new Vue({
		    el: '#tagsInput',
		    data: data3,
		    components: {
		      'v-tags': tags
		    }
	  	})

		//论文上传插件配置
        Dropzone.options.myAwesomeDropzone = {
        	paramName: "uploadPaper",
        	addRemoveLinks: true,
            autoProcessQueue: false,
            uploadMultiple: false,
            parallelUploads: 1,
            maxFiles: 1,
            maxFilesize: 10,
            acceptedFiles: "application/pdf",
            dictMaxFilesExceeded: "您最多只能上传1个文件！",
	        dictResponseError: "文件上传失败！",
	        dictInvalidFileType: "您不能上传该类型文件,文件类型只能是*.pdf！",
	        dictFallbackMessage: "浏览器不受支持！",
	        dictFileTooBig: "文件过大,超出上传文件最大支持！",
	        dictCancelUpload: "取消",
	        dictCancelUploadConfirmation: "确认取消",
	        dictRemoveFile: "删除",
            init: function() {
                var myDZ = this;

                this.element.querySelector("button[type=submit]").addEventListener("click", function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    myDZ.processQueue();
                });

                this.on("success", function(file, args){
                	var res = JSON.parse(args);
                	if (res.result === "success") {
                		myDZ.removeAllFiles();
                		getPaperList()
                		swal("已上传成功! ", "", "success");
                	}
                	else {
                		myDZ.removeAllFiles();
                		swal("上传失败! ", "请重新上传! ", "error");
                	}
                });

                this.on("error", function(file, errorMsg) {
                	myDZ.removeAllFiles();
                	swal("请求上传失败! ", errorMsg, "error");
                });
            },
            // accept: function(file, done) {
            // 	done();
            // }
        };
        $(".dz-message span").html("点击或拖拽上传");

        //论文列表
        var data4 = {
			paperItem: []
        }
        var app4 = new Vue({
            el: '#vertical-timeline',
            data: data4
        });

        var data5 = {
        	following_list: []
        }        
        var data6 = {
        	followed_list: []
        }

        $.ajax({
    		url: '/api/get_follow',
    		type: 'POST',
    		data: {
    			id: [[current_user.email|tojson]]
    		},
    		success: function(data) {
    			var res = JSON.parse(data);
    			if (res.result === "success") {
					for (var i=0;i<res.follow.length;i++) {
						if (res.follow[i].profile.avatar === "") {
							res.follow[i].profile.avatar = "../static/avatar/init.png"
						}
    					data5.following_list.push({
    						profile: res.follow[i].profile,
    						isFollow: true
    					})
    				}
    				
    				for (var i=0;i<res.followed.length;i++) {
    					data6.followed_list.push({
    						profile: res.followed[i].profile,
    						isFollow: res.followed[i].isFollow
    					})
    				}

					$("span.badge-info").text(data5.following_list.length);
					data2.following_list_total = data5.following_list.length
					$("span.badge-warning").text(data6.followed_list.length);
					data2.followed_list_total = data6.followed_list.length
    			}
    		},
    		error: function() {
    			console.log("getFollowList,error");
    		}
    	});

		//关注列表
        var app5 = new Vue({
        	el: '#followingList',
        	data: data5,
        	methods: {
                toPublicProfile: function(ID) {
                    window.open("/api/to_public_profile?id=" + ID);
                },
                toFollow: function(publicID, index) {
			        $.ajax({
			    		url: '/api/to_follow',
			    		type: 'POST',
			    		data: {
			    			id: publicID
			    		},
			    		success: function(data) {
			    			var res = JSON.parse(data);
			    			if (res.result === "success") {
			    				data5.following_list[index].isFollow = true;
			    				swal("关注成功! ", "", "success");
			    			}
			    			else {
			    				swal("关注失败! ", "请重新关注! ", "error");
			    			}
			    		},
			    		error: function() {
			    			swal("请求关注失败! ", "请重新关注! ", "error");
			    		}
			    	});
                },
                toUnfollow: function(publicID, index) {
			        $.ajax({
			    		url: '/api/cancel_follow',
			    		type: 'POST',
			    		data: {
			    			id: publicID
			    		},
			    		success: function(data) {
			    			var res = JSON.parse(data);
			    			if (res.result === "success") {
			    				data5.following_list[index].isFollow = false;
			    				swal("取消关注成功! ", "", "success");
			    			}
			    			else {
			    				swal("取消关注失败! ", "请重新取消关注! ", "error");
			    			}
			    		},
			    		error: function() {
			    			swal("请求取消关注失败! ", "请重新取消关注! ", "error");
			    		}
			    	});
                }
        	}
        });

        //被关注列表
        var app6 = new Vue({
        	el: '#followedList',
        	data: data6,
        	methods: {
                toPublicProfile: function(ID) {
                    window.open("/api/to_public_profile?id=" + ID);
                },
                toFollow: function(publicID, index) {
			        $.ajax({
			    		url: '/api/to_follow',
			    		type: 'POST',
			    		data: {
			    			id: publicID
			    		},
			    		success: function(data) {
			    			var res = JSON.parse(data);
			    			if (res.result === "success") {
			    				data6.followed_list[index].isFollow = true;
			    				swal("关注成功! ", "", "success");
			    			}
			    			else {
			    				swal("关注失败! ", "请重新关注! ", "error");
			    			}
			    		},
			    		error: function() {
			    			swal("请求关注失败! ", "请重新关注! ", "error");
			    		}
			    	});
                },
                toUnfollow: function(publicID, index) {
			        $.ajax({
			    		url: '/api/cancel_follow',
			    		type: 'POST',
			    		data: {
			    			id: publicID
			    		},
			    		success: function(data) {
			    			var res = JSON.parse(data);
			    			if (res.result === "success") {
			    				data6.followed_list[index].isFollow = false;
			    				swal("取消关注成功! ", "", "success");
			    			}
			    			else {
			    				swal("取消关注失败! ", "请重新取消关注! ", "error");
			    			}
			    		},
			    		error: function() {
			    			swal("请求取消关注失败! ", "请重新取消关注! ", "error");
			    		}
			    	});
                }
        	}
        });
	</script>

    <script>
        $(document).ready(function(){
 
        	// 跳到tab
        	$("#toTab3").click(function(){
        		$("#tab5").click();
        	});
        	$("#toTab4").click(function(){
        		$("#tab3").click();
        	});
        	$("#toTab5").click(function(){
        		$("#tab4").click();
        	});

			//头像上传
            uploadAvatar();

            //修改密码
	        $("#editNewPassword").click(function() {
	        	var oldPassword = $("#oldPassword").val()
	        	var newPassword = $("#newPassword").val()
	        	var confirm_newPassword = $("#confirm_newPassword").val()

	        	if (oldPassword === newPassword) {
	        		$("#oldPassword").val("");
	        		$("#newPassword").val("");
	        		$("#confirm_newPassword").val("");
	        		swal("请输入不相同的新旧密码! ", "", "error");
	        	}
	        	else if (newPassword.length > 8 && newPassword.length < 16 && newPassword === confirm_newPassword) {
					editPassword(oldPassword, newPassword, confirm_newPassword);
	        	}
	        	else {
	        		$("#oldPassword").val("");
	        		$("#newPassword").val("");
	        		$("#confirm_newPassword").val("");
	        		swal("请输入有效密码! ", "", "error");
	        	}
	        });

            // 关注领域[选择]添加标签
            $(".chosen-select").chosen({width: "350px"});
			$("#addField").change(function(){
				app3.$children[0].add($("#addField option:selected").val());
				data3.isShowMultiSelect = false;
			})

	        //用户关注
	      //   $(".followBtn").click(function(){
	      //   	if (this.innerText === " Follow") {
	      //   		$(this).html('<i class="fa fa-users"></i> Following');
	      //   		$(this).bind({
	      //   			mouseenter: function(e) {
				   //          $(this).css("background-color", "#FF4500");
				   //          $(this).html('<i class="fa fa-user-times"></i> Unfollow');
				   //      },
				   //      mouseleave: function(e) {
				   //          $(this).css("background-color", "#ffffff");
				   //          $(this).html('<i class="fa fa-users"></i> Following');
				   //      }
	      //   		});
	    		// }
	      //   	else {
	      //   		$(this).css("background-color", "#ffffff");
	      //   		$(this).unbind('mouseenter').unbind('mouseleave');
	      //   		$(this).html('<i class="fa fa-user-plus"></i> Follow');
	      //   	}
	      //   });

	        //论文列表
	        getPaperList();
            function animationHover(element, animation) {
			    element = $(element);
			    element.hover(
			        function () {
			            element.addClass('animated ' + animation);
			        },
			        function () {
			            //wait for animation to finish before removing classes
			            window.setTimeout(function () {
			                element.removeClass('animated ' + animation);
			            }, 2000);
			        });
			}
            $(".file-box").each(function() {
                animationHover(this, 'pulse');
            });

        	/*mainTab标签页请求*/
        	$('#mainTab a[data-toggle="tab"]').on('show.bs.tab', function(e) {

        		if ($(e.target).attr("id") === "tab1") { //个人信息页
        			console.log($(e.target).text());
        		}
        		else if ($(e.target).attr("id") === "tab2") { //关注领域页
        			console.log($(e.target).text());
        		}
        		else if ($(e.target).attr("id") === "tab3") { //我的关注页
        			console.log($(e.target).text());
        		}
        		else if ($(e.target).attr("id") === "tab4") { //谁关注我页
        			console.log($(e.target).text());
        		}
        		else if ($(e.target).attr("id") === "tab5") { //我的论文页
					console.log($(e.target).text());
        		}
        		else if ($(e.target).attr("id") === "tab6") { //关系图页
        			// getPaperNetwork();
        			getExpertNetwork();
        			console.log($(e.target).text());
        		}
        	});

       });
    </script>

    <script type="text/javascript">

		//作者关系图
        var dom2 = document.getElementById("coauthorGraph");
        var myChartGraph2 = echarts.init(dom2);
        // var app = {};
        option2 = null;
        // app.title = '作者关系图';

        var sendData2 = {"name": "Martin Ester"}
    	myChartGraph2.showLoading();

        function getExpertNetwork() {
	        $.ajax({
	        	url: "/api/expert_network",
	        	type: "POST",
	        	data: sendData2,
	        	success: function(data){
		        	myChartGraph2.hideLoading();

		        	var graph = JSON.parse(data);

	 				var years = [];
					for (var i=0;i<graph.length;i++){
	 					years.push(graph[i].year);
					}

		        	for (var i=0;i<graph.length;i++){
			        	graph[i].nodes.forEach(function(node){
			        		if (node.name === sendData2.name) {
			    		        node.itemStyle = {
			    		        	color: '#66CCFF'
			    		        };
			        		}
			        		else {
			    		        node.itemStyle = {
			    		        	color: '#FF3030'
			    		        };
			        		}						        
			        		// node.symbolSize = 10;
					        // node.value = node.symbolSize;
					        // node.category = node.attributes.modularity_class;
					        // Use random x, y
					        node.x = node.y = null;
					        node.draggable = false;
					        node.label = {
					        	show: true,
					        	position: 'bottom'
					        }
					        node.tooltip = {           
					        	position: function (point, params, dom, rect, size) {
					                $(dom).html('<div class="contact-box" style="color: #676a6c;background-color: #F0FFFF;padding: 10px;width: 120%;"><div style="width: 40%;float: left;"><div class="text-center" style="text-align: center;"><img alt="image" class="img-circle m-t-xs img-responsive" src="../static/common/img/init.png" width="64px" height="64px"><div class="m-t-xs font-bold">博士</div></div></div><div style="width: 60%;float: left;"><h4><strong>'+ node.name +'</strong><img alt="image" src="../static/common/img/female.png" width="20px" height="20px" style="margin: 0px 0px 2px 5px;"></h4><p><i class="fa fa-institution"></i> 华南理工大学</p><p><i class="fa fa-map-marker"></i> 广州大学城</p><p><i class="fa fa-phone"></i> 1377777777</p></div><div class="clearfix"></div></div>')
					            },
					            backgroundColor: '#FFFFFF'
					        }
			        	})
			        	graph[i].links.forEach(function(link) {
			        		link.lineStyle = {
			        			width: link.values,
			        			color: '#000000'
			        		}
			        	})
		        	}

		        	var optionInit = []
		        	for (var i=0;i<graph.length;i++){
		        		var nodeItem = {title: {}, series:[{}]}
		        		nodeItem.title.text = years[i] + ''
		        		nodeItem.series[0].data = graph[i].nodes
		        		nodeItem.series[0].links = graph[i].links
		        		optionInit.push(nodeItem)
		        	}

	        	    option2 = {
	        	    	baseOption: {

	        	    		timeline: {
					            // y: 0,
					            axisType: 'category',
					            // realtime: false,
					            // loop: false,
					            autoPlay: false,
					            // currentIndex: 2,
					            // playInterval: 1000,
					            // controlStyle: {
					            //     position: 'left'
					            // },
					            data: years,
					            label: {
					                // formatter : function(s) {
					                //     return (new Date(s)).getFullYear();
					                // }
					            }
					        },
					        title: {
					            subtext: '',
					            top: 'bottom',
					            left: 'right'
					        },
					        tooltip: {},
					        toolbox: {
					        	show: true,
					        	feature: {
					        		dataView: {readOnly: true},
					        		restore: {},
					        		saveAsImage: {}
					        	}
					        },
					        legend: {
					            // selectedMode: 'single',
					            data: ["Martin Ester"]
					        },
					        animation: false,
					        series : [
					            {
					                name: '',
					                type: 'graph',
					                layout: 'force',
					                roam: true,
					                forceNodeAdjacency: true,
					                cursor: 'pointer',
					                label: {
					                    normal: {
					                        position: 'right'
					                    }
					                },
					                force: {
					                    repulsion: 100
					                }
					            }
					        ]
					    },
					    options: optionInit
				    };

				    myChartGraph2.setOption(option2);
	        	},
	        	error: function (errorMsg) {
		            //alert("图表数据加载失败！");
		        }
	        });
        }

        myChartGraph2.on('click', function (params) {
			if (params.componentType === 'series') {
		        if (params.seriesType === 'graph') {
		            if (params.dataType === 'node') {
		            	window.open("/api/public_profile?ID=" + params.id);
		            }
		            else {

		            }
		        }
		    }

		});

        $('#chartTab a[data-toggle="tab"]').on('shown.bs.tab', function(e) {  
            // myChartGraph1.resize();
            myChartGraph2.resize();  
	    });         
	    window.onresize = function() {
        	// myChartGraph1.resize();
        	myChartGraph2.resize();
        }
    </script>

    <div id="return-top" style="position: fixed;right: 1%;bottom: 4%;z-index: 99;">
        <a onclick="backToTop()">
            <img src="../static/common/img/return-top.png" title="返回顶部">
        </a>
    </div>
    <script type="text/javascript">
    	function backToTop() {  
		    $('html,body').animate({  
		        scrollTop: 0  
		    }, 800);  
		}

		$(window).on('scroll', function () {
		    if ($(window).scrollTop() > $(window).height())  
		        $("#return-top").fadeIn();  
		    else  
		        $("#return-top").fadeOut();  
		});  
		$(window).trigger('scroll');
    </script>
</body>
</html>